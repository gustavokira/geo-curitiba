<!DOCTYPE html>
<meta charset="utf-8">
<style>

html{
  background: #fff;
}
body{
  padding: 50px;
}


.ticks {
  font: 9px sans-serif;
}

.track,
.track-inset,
.track-overlay {
  stroke-linecap: round;
}

.track {
  stroke: #000;
  stroke-opacity: 0.3;
  stroke-width: 10px;
}

.track-inset {
  stroke-width: 8px;
}

.track-overlay {
  pointer-events: stroke;
  stroke-width: 50px;
  cursor: pointer;
}

.handle {
  fill: #fff;
  stroke:#000;
  stroke-opacity: 0.5;
  stroke-width: 1.25px;
}


</style>
<body>
<script src="node_modules/d3/build/d3.min.js" charset="utf-8"></script>
<script src="node_modules/topojson/dist/topojson.min.js" charset="utf-8"></script>

<script src="src/base.js" charset="utf-8"></script>
<script src="src/lines.js" charset="utf-8"></script>
<script src="src/areas.js" charset="utf-8"></script>
<script src="src/slider.js" charset="utf-8"></script>

<svg width="200" height="500"></svg>

<script>



var divisaBairrosSliderWidth = new Slider("dbs",50,200);
divisaBairrosSliderWidth.init();
divisaBairrosSliderWidth.updateCb = function(h){
  divisaBairros.values.stroke.width = h;
  divisaBairros.update();
}

var divisaBairrosSliderOpacity = new Slider("dbs",50,100);
divisaBairrosSliderOpacity.min = 0;
divisaBairrosSliderOpacity.max = 1;
divisaBairrosSliderOpacity.ticks = 3;
divisaBairrosSliderOpacity.scale = d3.scaleLinear();
divisaBairrosSliderOpacity.init();
divisaBairrosSliderOpacity.updateCb = function(h){
  divisaBairros.values.stroke.opacity = h;
  divisaBairros.update();
}

var contornoCuritibaSlider = new Slider("ccs",50,200);
// contornoCuritibaSlider.init();
contornoCuritibaSlider.updateCb = function(h){
  contornoCuritiba.values.stroke.width = h;
  contornoCuritiba.update();
}

var divisaRegionaisSlider = new Slider("drs",50,200);
// divisaRegionaisSlider.init();
divisaRegionaisSlider.updateCb = function(h){
  divisaRegionais.values.stroke.width = h;
  divisaRegionais.update();
}

var zonasEleitoraisSlider = new Slider("ze",50,200);
// zonasEleitoraisSlider.init();
zonasEleitoraisSlider.updateCb = function(h){
  zonasEleitorais.values.stroke.width = h;
  zonasEleitorais.update();
}

var bairrosTemp = {
  9:{codigo:9,nome:"ÁGUA VERDE", value:0},
  18:{codigo:18,nome:"JARDIM SOCIAL", value:0},
  57:{codigo:57,nome:"XAXIM", value:0},
  22:{codigo:22,nome:"JARDIM DAS AMÉRICAS", value:0},
  26:{codigo:26,nome:"GUAÍRA", value:0},
  36:{codigo:36,nome:"BAIRRO ALTO", value:0},
  2:{codigo:2,nome:"SÃO FRANCISCO", value:0},
  4:{codigo:4,nome:"ALTO DA GLÓRIA", value:0},
  55:{codigo:55,nome:"ATUBA", value:0},
  16:{codigo:16,nome:"CABRAL", value:0},
  40:{codigo:40,nome:"LINDÓIA", value:0},
  44:{codigo:44,nome:"CAMPO COMPRIDO", value:0},
  3:{codigo:3,nome:"CENTRO CÍVICO", value:0},
  15:{codigo:15,nome:"JUVEVÊ", value:0},
  17:{codigo:17,nome:"HUGO LANGE", value:0},
  20:{codigo:20,nome:"CAPÃO DA IMBUIA", value:0},
  29:{codigo:29,nome:"SEMINÁRIO", value:0},
  23:{codigo:23,nome:"GUABIROTUBA", value:0},
  24:{codigo:24,nome:"PRADO VELHO", value:0},
  25:{codigo:25,nome:"PAROLIN", value:0},
  27:{codigo:27,nome:"PORTÃO", value:0},
  28:{codigo:28,nome:"VILA IZABEL", value:0},
  30:{codigo:30,nome:"CAMPINA DO SIQUEIRA", value:0},
  34:{codigo:34,nome:"BOA VISTA", value:0},
  14:{codigo:14,nome:"AHÚ", value:0},
  6:{codigo:6,nome:"CRISTO REI", value:0},
  8:{codigo:8,nome:"REBOUÇAS", value:0},
  59:{codigo:59,nome:"ORLEANS", value:0},
  32:{codigo:32,nome:"PILARZINHO", value:0},
  45:{codigo:45,nome:"MOSSUNGUÊ", value:0},
  5:{codigo:5,nome:"ALTO DA RUA XV", value:0},
  7:{codigo:7,nome:"JARDIM BOTÂNICO", value:0},
  61:{codigo:61,nome:"BUTIATUVINHA", value:0},
  52:{codigo:52,nome:"BARREIRINHA", value:0},
  54:{codigo:54,nome:"TINGUI", value:0},
  56:{codigo:56,nome:"BOQUEIRÃO", value:0},
  69:{codigo:69,nome:"RIVIERA", value:0},
  65:{codigo:65,nome:"SÍTIO CERCADO", value:0},
  19:{codigo:19,nome:"TARUMÃ", value:0},
  33:{codigo:33,nome:"SÃO LOURENÇO", value:0},
  35:{codigo:35,nome:"BACACHERI", value:0},
  11:{codigo:11,nome:"BIGORRILHO", value:0},
  13:{codigo:13,nome:"BOM RETIRO", value:0},
  58:{codigo:58,nome:"CAPÃO RASO", value:0},
  38:{codigo:38,nome:"HAUER", value:0},
  39:{codigo:39,nome:"FANNY", value:0},
  41:{codigo:41,nome:"NOVO MUNDO", value:0},
  42:{codigo:42,nome:"FAZENDINHA", value:0},
  43:{codigo:43,nome:"SANTA QUITÉRIA", value:0},
  1:{codigo:1,nome:"CENTRO", value:0},
  50:{codigo:50,nome:"ABRANCHES", value:0},
  10:{codigo:10,nome:"BATEL", value:0},
  67:{codigo:67,nome:"SÃO MIGUEL", value:0},
  68:{codigo:68,nome:"AUGUSTA", value:0},
  70:{codigo:70,nome:"CAXIMBA", value:0},
  64:{codigo:64,nome:"ALTO BOQUEIRÃO", value:0},
  66:{codigo:66,nome:"PINHEIRINHO", value:0},
  74:{codigo:74,nome:"TATUQUARA", value:0},
  73:{codigo:73,nome:"UMBARÁ", value:0},
  71:{codigo:71,nome:"CAMPO DE SANTANA", value:0},
  72:{codigo:72,nome:"GANCHINHO", value:0},
  21:{codigo:21,nome:"CAJURU", value:0},
  37:{codigo:37,nome:"UBERABA", value:0},
  49:{codigo:49,nome:"TABOÃO", value:0},
  51:{codigo:51,nome:"CACHOEIRA", value:0},
  53:{codigo:53,nome:"SANTA CÂNDIDA", value:0},
  75:{codigo:75,nome:"CIDADE INDUSTRIAL DE CURITIBA", value:0},
  62:{codigo:62,nome:"LAMENHA PEQUENA", value:0},
  12:{codigo:12,nome:"MERCÊS", value:0},
  46:{codigo:46,nome:"SANTO INÁCIO", value:0},
  31:{codigo:31,nome:"VISTA ALEGRE", value:0},
  60:{codigo:60,nome:"SÃO BRAZ", value:0},
  48:{codigo:48,nome:"SÃO JOÃO", value:0},
  47:{codigo:47,nome:"CASCATINHA", value:0},
  63:{codigo:63,nome:"SANTA FELICIDADE",value:0}
}

var width = 800,
    height = 800;

var svg = d3.select("body").append("svg")
    .attr("width", width)
    .attr("height", height);



var scaleOptions = {
  'powtwo':{
    'name': 'exponencial 2',
    'scale':d3.scalePow().exponent(2)
  },
  'logE':{
    'name': 'log e',
    'scale':d3.scaleLog().base(Math.E)
  }
}

var currentState = {
  scale: scaleOptions.logE.scale
}

var base = new Base(svg);
var divisaBairros = new Lines("divisabairros",{url:"data/divisa_de_bairros.topo.json",name:"bairros"});
var divisaRegionais = new Lines("regionais",{url:"data/divisa_de_regionais.topo.json",name:"regionais"});
var contornoCuritiba = new Lines("contorno",{url:"data/contorno_de_curitiba.topo.json",name:"curitiba"});
var zonasEleitorais = new Lines("zonas",{url:"data/divisa_e_contorno_de_zonas_eleitorais.topo.json",name:"zonas"});
var bairros = new Areas("bairros",{url:"data/bairros.topo.json",name:"bairros"});

//ordem de inscricao na base define order no "plano 2d" ultimo = cima, primeiro = baixo
base.addChild(bairros);
base.addChild(divisaBairros);
base.addChild(divisaRegionais);
base.addChild(contornoCuritiba);
base.addChild(zonasEleitorais);

divisaRegionais.values.stroke.color = "#666";
divisaRegionais.values.stroke.width = 1;

divisaBairros.values.stroke.color = "#999";
divisaBairros.values.stroke.width = 0.5;

contornoCuritiba.values.stroke.color = "#666";
contornoCuritiba.values.stroke.width = 1;

zonasEleitorais.values.stroke.width = 0;

base.load()
  .then(function(data){
    console.log(data);

  bairros.raw.forEach(function(r){
      bairrosTemp[r.properties.codigo].value = r.properties.area;
      r.value = bairrosTemp[r.properties.codigo].value;
      console.log(r.properties.codigo, bairrosTemp[r.properties.codigo]);
  });

  },function(err){
    console.log(err);
  })


function update(){
  bairros.colorScale = currentState.scale
      .interpolate(d3.interpolateHcl)
      .range([d3.rgb("#fff"), d3.rgb('#333')]);

  bairros.update();
  divisaBairros.update();
}

</script>

<input type="text" value="#333">

<button onclick="update()"></button>
</body>